(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-repairHandle-repairHandle"],{3121:function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.appraiseRepair=function(e,t){return new Promise((function(a,i){if(""!=e.remark)if(""!=e.repairId){var o={repairId:e.repairId,repairType:e.repairType,repairChannel:e.repairChannel,publicArea:e.publicArea,communityId:e.communityId,context:e.remark};e.context.post({url:n.default.appraiseRepairNew,data:o,success:function(e){a(e)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},t)}else uni.showToast({title:r.default.t("wbhbxxxx"),icon:"none"});else uni.showToast({title:r.default.t("qtxpjnrs"),icon:"none"})}))},t.dispatchRepair=function(e,t){return new Promise((function(a,i){var s={staffId:e.staffId,staffName:e.staffName,context:e.content,repairId:e.repairId,repairType:e.repairType,action:e.action,communityId:(0,o.getCurrentCommunity)().communityId,photos:[],userId:e.userId,userName:e.userName},u=e.photos;u.forEach((function(e){s.photos.push({photo:e})}));var c="";""==s.context?c=r.default.t("please_enter_handling_comments"):""==s.staffId||""==s.staffName?c=r.default.t("qtxsf1"):""==s.repairId?c=r.default.t("errorData"):"TRANSFER"==s.action&&s.userId==s.staffId&&(c=r.default.t("bnzdgzj")),""==c?e.context.post({url:n.default.repairDispatch,data:s,success:function(e){a(e)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},t):wx.showToast({title:c,icon:"none",duration:2e3})}))},t.finishRepair=function(e,t){return new Promise((function(a,i){var s={feeFlag:e.feeFlag,context:e.content,repairId:e.repairId,repairChannel:e.repairChannel,publicArea:e.publicArea,maintenanceType:e.feeFlag,repairType:e.repairType,action:e.action,communityId:(0,o.getCurrentCommunity)().communityId,beforeRepairPhotos:[],afterRepairPhotos:[],repairObjType:e.repairObjType,userId:e.userId,userName:e.userName,storeId:e.storeId,choosedGoodsList:e.resourceStoreInfo,totalPrice:e.amount,payType:e.payType},u=e.beforeRepairPhotos;u.forEach((function(e){s.beforeRepairPhotos.push({photo:e})}));var c=e.afterRepairPhotos;c.forEach((function(e){s.afterRepairPhotos.push({photo:e})}));var f="";if(s.feeFlag?""==s.context?f=r.default.t("please_enter_handling_comments"):s.beforeRepairPhotos.length<=0||s.afterRepairPhotos.length<=0?f=r.default.t("qsctptt"):""==s.repairId?f=r.default.t("errorData"):("1001"==s.maintenanceType||"1003"==s.maintenanceType)&&s.choosedGoodsList.length<1?f=r.default.t("qxzwppp"):"1001"==s.maintenanceType&&""==s.payType?f=r.default.t("qxzzffssss"):("1001"==s.maintenanceType||"1003"==s.maintenanceType)&&s.choosedGoodsList.length>=1&&s.choosedGoodsList.forEach((function(e){(!e.useNumber||e.useNumber<1)&&(f=r.default.t("spslywww")),"1001"==s.maintenanceType&&(!e.price||e.price<0)&&(f=r.default.t("spjgywww"))})):f=r.default.t("qxzlxx"),""!=f)return wx.showToast({title:f,icon:"none",duration:2e3}),void(e.onoff=!0);"1002"!=s.maintenanceType&&"1004"!=s.maintenanceType||(s.useNumber=0,s.choosedGoodsList=[]),e.context.post({url:n.default.repairFinish,data:s,success:function(t){e.onoff=!0,a(t)},fail:function(t){e.onoff=!0,wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},t)}))},t.loadRepairStaff=function(e,t,a){return new Promise((function(i,o){e.context.get({url:n.default.listRepairTypeUsers,data:t,success:function(e){i(e)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},t.queryDictInfo=function(e,t,a){return new Promise((function(i,o){e.context.get({url:n.default.queryDictInfo,data:t,success:function(e){i(e.data)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},t.queryRepairInfo=function(e,t,a){return new Promise((function(i,o){e.context.get({url:n.default.queryRepairInfo,data:t,success:function(e){i(e.data)},fail:function(e){wx.showToast({title:"",icon:"none",duration:2e3})}},a)}))},t.queryResourceStoreResName=function(e,t,a){return new Promise((function(i,o){e.context.get({url:n.default.queryResourceStoreResName,data:t,success:function(e){i(e)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},t.repairStart=function(e,t,a){return new Promise((function(i,o){e.context.post({url:n.default.repairStart,data:t,success:function(e){i(e.data)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},t.repairStop=function(e,t,a){return new Promise((function(i,o){e.context.post({url:n.default.repairStop,data:t,success:function(e){i(e.data)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},t.replyRepairAppraise=function(e,t,a){return new Promise((function(i,o){t.context.post({url:n.default.replyRepairAppraise,data:e,success:function(e){i(e.data)},fail:function(e){wx.showToast({title:r.default.t("server_error"),icon:"none",duration:2e3})}},a)}))},a("bf0f"),a("2797"),a("aa9c");var n=i(a("f0de")),o=a("2d9e"),r=i(a("3e79"))},"596c":function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("aa9c"),a("bf0f"),a("2797"),a("c223"),a("e838"),a("dd2b");var n=a("3121"),o=a("9ef9"),r=i(a("9b8e")),s=a("2d9e"),u=i(a("840b"));r.default.prototype.$preventClick=o.preventClick;var c={data:function(){var e=this,t=function(t){return e.$t(t)};return{onoff:!0,staffCloums:[{staffName:t("please_select_employee")}],action:"",repairId:"",publicArea:"",repairType:"",repairChannel:"",imgList:[],photos:[],beforeRepairImgList:[],afterRepairImgList:[],beforeRepairPhotos:[],afterRepairPhotos:[],repairStaffIndex:0,staffId:"",staffName:"",content:"",userId:"",userName:"",feeFlag:"",amount:0,feeCloums:[{id:"",name:t("please_select")}],feeIndex:0,repairObjType:"",storeId:"",resourceStoreInfo:[],payTypes:[{statusCd:"",name:t("please_select")}],payTypeIndex:0,payType:"",communityId:"",uploadImageBefore:{maxPhotoNum:4,imgTitle:t("upload_before_maintenance_image"),canEdit:!0},uploadImageAfter:{maxPhotoNum:4,imgTitle:t("upload_after_maintenance_image"),canEdit:!0}}},components:{uploadImageAsync:u.default},onLoad:function(e){var t=this;this.communityId=(0,s.getCurrentCommunity)().communityId,this.java110Context.onLoad(),this.publicArea=e.publicArea,this.action=e.action,this.repairId=e.repairId,this.repairType=e.repairType,this.repairObjType=e.repairObjType,this.repairChannel=e.repairChannel;var a=this.java110Context.getUserInfo();this.userId=a.userId,this.storeId=a.storeId,this.userName=a.userName,"BACK"==this.action&&(this.staffId=e.preStaffId,this.staffName=e.preStaffName),"004"==this.repairObjType?this.feeCloums.push({id:"1001",name:t.$t("paid_service")},{id:"1002",name:t.$t("free_service")}):this.feeCloums.push({id:"1003",name:t.$t("need_materials")},{id:"1004",name:t.$t("no_need_materials")}),this._loadRepairStaff(),this._loadPayTypes(),uni.$on("getResourceInfo",(function(e){console.log(e),t._getResourceInfo(e)}))},onUnload:function(){uni.$off("getResourceInfo")},methods:{sendImagesDataBefore:function(e){var t=this;console.log("before",e),this.beforeRepairPhotos=[],e.length>0&&e.forEach((function(e){t.beforeRepairPhotos.push(e.fileId)}))},sendImagesDataAfter:function(e){var t=this;console.log("after",e),this.afterRepairPhotos=[],e.length>0&&e.forEach((function(e){t.afterRepairPhotos.push(e.fileId)}))},_loadPayTypes:function(){var e=this;(0,n.queryDictInfo)(this,{name:"r_repair_pool",type:"pay_type"},0==this.payTypes.length).then((function(t){e.payTypes=e.payTypes.concat(t)}))},payTypeChange:function(e){if(this.payTypeIndex=e.target.value,0!=this.payTypeIndex){var t=this.payTypes[this.payTypeIndex];this.payType=t.statusCd}else this.payType=""},_getResourceInfo:function(e){e=JSON.parse(e),this.resourceStoreInfo.push(e),this._updateTotalPrice()},userNumberChange:function(e,t){if("inc"==t)this.resourceStoreInfo[e].useNumber=parseFloat(this.resourceStoreInfo[e].useNumber)+1;else{if(this.resourceStoreInfo[e].useNumber<=1)return void uni.showToast({title:this.$t("cannot_reduce_further"),icon:"none"});this.resourceStoreInfo[e].useNumber-=1}this._updateTotalPrice()},_updateTotalPrice:function(){var e=this;this.amount=0,this.resourceStoreInfo.forEach((function(t){var a=parseFloat(t.useNumber),i=parseFloat(t.price);isNaN(a)||isNaN(i)||(e.amount+=a*i)}))},_removeResourceItem:function(e){this.resourceStoreInfo.splice(e,1),this._updateTotalPrice()},_openSelectResourceModel:function(){uni.navigateTo({url:"/pages/repairHandle/selectResource?feeFlag="+this.feeFlag})},_loadRepairStaff:function(){var e=this,t={repairType:this.repairType,communtiyId:(0,s.getCurrentCommunity)().communityId,page:1,row:50,state:"9999"};(0,n.loadRepairStaff)(this,t,0==this.staffCloums.length).then((function(t){var a=t.data;if(0==a.code){var i=a.data;e.staffCloums=e.staffCloums.concat(i)}else uni.showToast({icon:"none",title:a.msg})}))},staffChange:function(e){if(this.repairStaffIndex=e.target.value,0==this.repairStaffIndex)return this.staffId="",void(this.staffName="");var t=this.staffCloums[this.repairStaffIndex];this.staffId=t.staffId,this.staffName=t.staffName},feeChange:function(e){if(this.feeIndex=e.target.value,0!=this.feeIndex){var t=this.feeCloums[this.feeIndex];this.feeFlag=t.id}else this.feeFlag=""},_dispatchRepair:function(e){var t=this;(0,n.dispatchRepair)(this,!0).then((function(e){var a=e.data;if(0==a.code)return"DISPATCH"==t.action?void uni.navigateTo({url:"/pages/repairOrder/repairOrder"}):void uni.navigateTo({url:"/pages/repairDispatch/repairDispatch"});wx.showToast({title:a.msg,icon:"none",duration:2e3})}))},_finishRepair:function(){uni.showLoading({title:this.$t("chulizhong")}),(0,n.finishRepair)(this,!0).then((function(e){var t=e.data;0!=t.code?uni.showToast({title:t.msg,icon:"none",duration:2e3}):uni.navigateTo({url:"/pages/repairDispatch/repairDispatch"})})),uni.hideLoading()}}};t.default=c},"6db6":function(e,t,a){"use strict";var i=a("edfe"),n=a.n(i);n.a},"9ef9":function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.getFileType=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split("."),a=t[t.length-1];if(!a)return"";a=a.toLocaleLowerCase();var i=["png","jpg","jpeg","bmp","gif","webp"];if(i.includes(a))return"image";var n=["mp4","m4v"];if(n.includes(a))return"video";var o=["mp3","m4a","wav","aac"];if(o.includes(a))return"audio";var r=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","plain"];return r.includes(a)?"office":"unknown"},t.preventClick=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=this;a.onoff?(a.onoff=!1,e(t)):uni.showToast({title:"操作过于频繁",icon:"none"})},a("4626")},b722:function(e,t,a){"use strict";a.r(t);var i=a("596c"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);t["default"]=n.a},c0ca:function(e,t,a){var i=a("c86c");t=i(!1),t.push([e.i,".use-num-container[data-v-02e68f75]{display:flex;flex-direction:row}.use-num-input[data-v-02e68f75]{width:%?100?%;text-align:center;padding:0}.inc[data-v-02e68f75],\n.dec[data-v-02e68f75]{border:1px solid #000;border-radius:50%;width:%?40?%;height:%?40?%;text-align:center;line-height:%?40?%}.row[data-v-02e68f75]{width:95%;margin:0 auto;height:%?60?%;line-height:%?60?%;display:flex;flex-direction:row;justify-content:space-between}.item-t[data-v-02e68f75]{display:inline-block;text-align:center}.inline-input[data-v-02e68f75]{display:inline-block;width:%?100?%;vertical-align:middle;border-radius:%?15?%}.t-remove[data-v-02e68f75]{color:#0081ff;text-decoration:underline}",""]),e.exports=t},cba3:function(e,t,a){"use strict";a.r(t);var i=a("efa5c"),n=a("b722");for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);a("6db6");var r=a("828b"),s=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"02e68f75",null,!1,i["a"],void 0);t["default"]=s.exports},edfe:function(e,t,a){var i=a("c0ca");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("967d").default;n("fcbc0834",i,!0,{sourceMap:!1,shadowMode:!1})},efa5c:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",["FINISH"!=e.action?a("v-uni-view",["BACK"==e.action?a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("maintenance_staff")))]),a("v-uni-input",{attrs:{disabled:"disabled",placeholder:e.$t("please_enter_repairer")},model:{value:e.staffName,callback:function(t){e.staffName=t},expression:"staffName"}})],1):a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("maintenance_staff")))]),a("v-uni-picker",{attrs:{value:e.repairStaffIndex,range:e.staffCloums,"range-key":"staffName"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.staffChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.staffCloums[e.repairStaffIndex].staffName))])],1)],1)],1):a("v-uni-view",["004"!=e.repairObjType?a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("need_materials")))]),a("v-uni-picker",{attrs:{value:e.feeIndex,range:e.feeCloums,"range-key":"name"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.feeChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.feeCloums[e.feeIndex].name))])],1)],1):e._e(),"004"==e.repairObjType?a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("maintenance_type")))]),a("v-uni-picker",{attrs:{value:e.feeIndex,range:e.feeCloums,"range-key":"name"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.feeChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.feeCloums[e.feeIndex].name))])],1)],1):e._e(),"1001"==e.feeFlag||"1003"==e.feeFlag?a("v-uni-view",{staticClass:"flex flex-direction margin-top"},[a("v-uni-button",{staticClass:"cu-btn bg-blue margin-tb-sm lg",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e._openSelectResourceModel()}}},[e._v(e._s(e.$t("select_product")))])],1):e._e(),("1001"==e.feeFlag||"1003"==e.feeFlag)&&e.resourceStoreInfo.length>0?a("v-uni-view",[a("v-uni-view",{staticClass:"row"},[a("v-uni-view",{staticClass:"item-t text-bold"},[e._v(e._s(e.$t("product")))]),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"1001"==e.feeFlag,expression:"feeFlag=='1001'"}],staticClass:"item-t text-bold"},[e._v(e._s(e.$t("price"))+"MOP")]),a("v-uni-view",{staticClass:"item-t text-bold"},[e._v(e._s(e.$t("quantity")))]),a("v-uni-view",{staticClass:"item-t text-bold"},[e._v(e._s(e.$t("operation")))])],1),e._l(e.resourceStoreInfo,(function(t,i){return a("v-uni-view",{staticClass:"resource-item text-grey"},[a("v-uni-view",{staticClass:"row"},[t.isCustom?a("v-uni-view",{staticClass:"item-t"},[e._v(e._s(t.customGoodsName))]):a("v-uni-view",{staticClass:"item-t"},[e._v(e._s(t.resName)+"("+e._s(t.specName?t.specName:"-")+")")]),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"1001"==e.feeFlag,expression:"feeFlag=='1001'"}],staticClass:"item-t"},[a("v-uni-input",{staticClass:"inline-input text-grey bg-white",attrs:{type:"number",disabled:!t.isCustom&&t.outHighPrice==t.outLowPrice},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e._updateTotalPrice()}},model:{value:t.price,callback:function(a){e.$set(t,"price",a)},expression:"item.price"}})],1),a("v-uni-view",{staticClass:"item-t"},[a("v-uni-text",{staticClass:"cuIcon-move text-black padding-right-sm padding-left-sm",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.userNumberChange(i,"dec")}}}),a("v-uni-input",{staticClass:"inline-input text-grey bg-white",attrs:{type:"number"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e._updateTotalPrice()}},model:{value:t.useNumber,callback:function(a){e.$set(t,"useNumber",a)},expression:"item.useNumber"}}),a("v-uni-text",{staticClass:"cuIcon-add text-black padding-right-sm padding-left-sm",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.userNumberChange(i,"inc")}}})],1),a("v-uni-view",{staticClass:"item-t"},[a("v-uni-text",{staticClass:"t-remove",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e._removeResourceItem(i)}}},[e._v(e._s(e.$t("remove")))])],1)],1),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"1001"==e.feeFlag&&!t.isCustom&&t.outHighPrice!=t.outLowPrice,expression:"feeFlag == '1001' && !item.isCustom && item.outHighPrice != item.outLowPrice"}],staticClass:"row"},[e._v(e._s(e.$t("price_range"))+"("+e._s(t.outLowPrice)+" - "+e._s(t.outHighPrice)+")")])],1)}))],2):e._e(),"1001"==e.feeFlag?a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("total"))+"MOP")]),a("v-uni-input",{attrs:{disabled:"disabled"},model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}})],1):e._e()],1),"1001"==e.feeFlag?a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("payment_method")))]),a("v-uni-picker",{attrs:{value:e.payTypeIndex,range:e.payTypes,"range-key":"name"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.payTypeChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.payTypes[e.payTypeIndex].name))])],1)],1):e._e(),a("v-uni-view",{staticClass:"cu-form-group margin-top"},[a("v-uni-textarea",{attrs:{placeholder:e.$t("please_enter_handling_comments")},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1),"FINISH"==e.action?a("v-uni-view",[a("uploadImageAsync",{ref:"vcUploadRef",staticStyle:{"margin-top":"30upx"},attrs:{communityId:e.communityId,maxPhotoNum:e.uploadImageBefore.maxPhotoNum,canEdit:e.uploadImageBefore.canEdit,title:e.uploadImageBefore.imgTitle},on:{sendImagesData:function(t){arguments[0]=t=e.$handleEvent(t),e.sendImagesDataBefore.apply(void 0,arguments)}}}),a("uploadImageAsync",{ref:"vcUploadRef",staticStyle:{"margin-top":"30upx"},attrs:{communityId:e.communityId,maxPhotoNum:e.uploadImageAfter.maxPhotoNum,canEdit:e.uploadImageAfter.canEdit,title:e.uploadImageAfter.imgTitle},on:{sendImagesData:function(t){arguments[0]=t=e.$handleEvent(t),e.sendImagesDataAfter.apply(void 0,arguments)}}})],1):a("v-uni-view"),"FINISH"==e.action?a("v-uni-view",{staticClass:"flex flex-direction margin-top"},[a("v-uni-button",{staticClass:"cu-btn bg-blue margin-tb-sm lg",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$preventClick(e._finishRepair)}}},[e._v(e._s(e.$t("complete")))])],1):a("v-uni-view",{staticClass:"flex flex-direction margin-top"},[a("v-uni-button",{staticClass:"cu-btn bg-blue margin-tb-sm lg",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e._dispatchRepair()}}},[e._v("提交")])],1)],1)},n=[]}}]);