(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-maintainance-excuteOneMaintainance"],{"10c4":function(t,e,i){"use strict";function n(t,e){var i=new Image;i.src=t,i.onload=function(){var t=this.height,i=this.width,n=document.createElement("canvas"),a=n.getContext("2d"),o=document.createAttribute("width");o.nodeValue=i;var c=document.createAttribute("height");c.nodeValue=t,n.setAttributeNode(o),n.setAttributeNode(c),a.drawImage(this,0,0,i,t);var s=n.toDataURL("image/jpeg",.3);n=null,e(s)}}i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.base64ToBlob=function(t){var e=t.split(","),i=e[0].match(/:(.*?);/)[1],n=atob(e[1]),a=n.length,o=new Uint8Array(a);while(a--)o[a]=n.charCodeAt(a);return new Blob([o],{type:i})},e.translate=function(t,e){n(t,e)},e.translateH5=n,i("5c47"),i("2c10"),i("c9b5"),i("15d1"),i("d5c6"),i("5a56"),i("f074"),i("4db2"),i("bf0f"),i("c976"),i("4d8f"),i("7b97"),i("668a"),i("c5b7"),i("8ff5"),i("2378"),i("641a"),i("64e0"),i("cce3"),i("efba"),i("d009"),i("bd7d"),i("7edd"),i("d798"),i("f547"),i("5e54"),i("b60a"),i("8c18"),i("12973"),i("f991"),i("198e"),i("8557"),i("63b1"),i("1954"),i("1cf1")},"37c9":function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default,a=i("3639").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("64aa"),i("bf0f"),i("2797"),i("5ef2"),i("aa9c"),i("dd2b");var o=a(i("10c4")),c=n(i("91c2")),s=i("a4e1"),u=i("8196"),r=(u.factory,{name:"vc-upload",data:function(){return{photos:[],imgList:[],photoUrl:c.default.commonBaseUrl+"/callComponent/download/getFile/file",sendImgList:[]}},props:{communityId:{type:String,default:""},title:{type:String,default:"image_upload"},maxPhotoNum:{type:Number,default:1},count:{type:Number,default:1},sizeType:{type:Array,default:function(){return["original","compressed"]}},sourceType:{type:Array,default:function(){return["album","camera"]}},canEdit:{type:Boolean,default:!0}},watch:{photos:function(t){this.sendData()},deep:!0},mounted:function(){this._initImageList(this.sendImgList)},methods:{_initImageList:function(t){var e=this;this.sendImgList=t,this.sendImgList.forEach((function(t,i){if(t.indexOf("base64,")>-1&&e.imgList.push(_photo),t.indexOf("https")>-1||t.indexOf("http")>-1||t.indexOf(e.photoUrl)>-1){e.imgList.push(t);var n=e._getUrlParams(t);n["fileId"]&&e.photos.push({fileId:n["fileId"],url:t})}else{var a=e.photoUrl+"?fileId="+t+"&communityId=-1&time="+new Date;e.imgList.push(a),e.photos.push({fileId:t,url:a})}})),console.log(this.imgList)},sendData:function(){this.$emit("sendImagesData",this.photos)},_getUrlParams:function(t){if(t.indexOf("?")<0)return{fileId:t.substring(t.indexOf("img"))};for(var e=t.split("?")[1],i={},n=e.split("&"),a=0,o=n.length;a<o;a++){var c=n[a].split("=");i[c[0]]=c[1]}return i},deleteImage:function(t){this.imgList.splice(t,1),this.photos.splice(t,1)},ChooseImage:function(){var t=this;wx.chooseImage({count:this.count,sizeType:this.sizeType,sourceType:this.sourceType,success:function(e){var i=e.tempFilePaths[0];t.imgList.push(i),t.$forceUpdate(),o.translate(i,(function(e){var i={uploadFile:e,communityId:t.communityId};(0,s.uploadImageAsync)(i,t).then((function(e){t.photos.push(e)}))}))}})},preview:function(t){var e=this.imgList;e.length<1||(e.forEach((function(t,i){var n=t.indexOf("/callComponent");0==n&&(e[i]=c.default.commonBaseUrl+t)})),uni.previewImage({current:t,urls:e}))}}});e.default=r},"3d9b":function(t,e,i){"use strict";i.r(e);var n=i("9f50"),a=i("d849");for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);var c=i("828b"),s=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"527ee613",null,!1,n["a"],void 0);e["default"]=s.exports},"69d3":function(t,e,i){var n=i("921b");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("967d").default;a("442c5c4d",n,!0,{sourceMap:!1,shadowMode:!1})},"7ecf":function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.UpdateMaintainanceTask=function(t,e){return new Promise((function(i,n){t.context.post({url:a.default.UpdateMaintainanceTask,data:e,success:function(t){i(t.data)},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.queryDictInfo=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.queryDictInfo,data:e,success:function(t){i(t.data)},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.queryMaintainanceItemTitle=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.listMaintainanceItem,data:e,success:function(t){var e=t.data;0!=e.code?n(e.msg):i(e.data)},fail:function(t){n(t)}})}))},e.queryMaintainanceTask=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.listMaintainanceTask,data:e,success:function(t){var e=t.data;if(0==e.code)return t.data.data.forEach((function(t,e){t.timeStr=t.planInsTime.replace(/:\d{1,2}$/," ")})),void i(t.data.data);n(e.msg)},fail:function(t){n(t)}})}))},e.queryMaintainanceTaskDetail=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.listMaintainanceTaskDetail,data:e,success:function(t){var e=t.data;if(0==e.code)return e.data.forEach((function(t){})),void i(e.data);n(e.msg)},fail:function(t){n(t)}})}))},e.updateMaintainanceTaskDetail=function(t,e){var i="";""==e.taskId?i="数据异常，保养任务为空":""==e.taskDetailId?i="数据异常，保养任务详情为空":""==e.machineId?i="设备不能为空":""==e.machineName?i="设备名称不能为空":""==e.patrolType?i="保养情况不能为空":""==e.description?i="保养说明不能为空":""==e.userId?i="数据异常，保养人为空":e.photos.length<=0&&(i="请上传保养图片");if(""!=i)return void wx.showToast({title:i,icon:"none",duration:2e3});return uni.showLoading({title:"请稍后..."}),new Promise((function(i,n){t.context.post({url:a.default.updateMaintainanceTaskDetail,data:e,success:function(t){i(t.data),uni.hideLoading()},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3}),uni.hideLoading()}})}))},i("bf0f"),i("2797"),i("5c47"),i("a1c1"),i("01a2"),i("e39c");var a=n(i("f3d1"))},8288:function(t,e,i){"use strict";var n=i("69d3"),a=i.n(n);a.a},"921b":function(t,e,i){var n=i("c86c");e=n(!1),e.push([t.i,".block__title[data-v-012e15e1]{margin:0;font-weight:400;font-size:14px;color:rgba(69,90,100,.6);padding:%?40?% %?30?% %?20?%}",""]),t.exports=e},"94f1":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"block__title"},[t._v("保养"+t._s(t.machineName))]),i("v-uni-form",[t._l(t.titles,(function(e,n){return i("v-uni-view",{key:n},[i("v-uni-view",{staticClass:"block__title"},[t._v(t._s(e.itemTitle))]),"1001"==e.titleType?i("v-uni-radio-group",{staticClass:"block",on:{change:function(i){arguments[0]=i=t.$handleEvent(i),t.radioChange(i,e)}}},t._l(e.titleValues,(function(n,a){return i("v-uni-view",{key:a,staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(n.itemValue))]),i("v-uni-radio",{class:e.radio==n.itemValue?"checked":"",attrs:{checked:e.radio==n.itemValue,value:n.itemValue}})],1)})),1):"2002"==e.titleType?i("v-uni-checkbox-group",{staticClass:"block",on:{change:function(i){arguments[0]=i=t.$handleEvent(i),t.checkboxChange(i,e)}}},t._l(e.titleValues,(function(n,a){return i("v-uni-view",{key:a,staticClass:"cu-form-group "},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(n.itemValue))]),i("v-uni-checkbox",{class:"1"==e.radio[a].selected?"checked":"",attrs:{checked:"1"==e.radio[a].selected,value:n.itemValue}})],1)})),1):i("v-uni-view",[i("v-uni-view",{staticClass:"cu-form-group "},[i("v-uni-textarea",{attrs:{maxlength:"512",placeholder:"请回答"},model:{value:e.radio,callback:function(i){t.$set(e,"radio",i)},expression:"item.radio"}})],1)],1)],1)})),i("uploadImageAsync",{ref:"vcUploadRef",staticStyle:{"margin-top":"30rpx"},attrs:{communityId:t.communityId,maxPhotoNum:t.uploadImage.maxPhotoNum,canEdit:t.uploadImage.canEdit,title:t.uploadImage.imgTitle},on:{sendImagesData:function(e){arguments[0]=e=t.$handleEvent(e),t.sendImagesData.apply(void 0,arguments)}}})],2),i("v-uni-view",{staticClass:"padding flex flex-direction"},[i("v-uni-button",{staticClass:"cu-btn bg-green margin-tb-sm lg",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.$preventClick(t._submitExcuteMaintainance)}}},[t._v("提交")])],1)],1)},a=[]},9521:function(t,e,i){"use strict";i.r(e);var n=i("e63e"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},"9f50":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"cu-bar bg-white "},[i("v-uni-view",{staticClass:"action"},[t._v(t._s(t.title))]),t.canEdit?i("v-uni-view",{staticClass:"action"},[t._v(t._s(t.imgList.length)+"/"+t._s(t.maxPhotoNum))]):t._e()],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"grid col-4 grid-square flex-sub"},[t._l(t.imgList,(function(e,n){return i("v-uni-view",{staticClass:"bg-img",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.preview(n)}}},[i("v-uni-image",{attrs:{src:e,mode:"aspectFill"}}),t.canEdit?i("v-uni-view",{staticClass:"cu-tag bg-red",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.deleteImage(n)}}},[i("v-uni-text",{staticClass:"cuIcon-close"})],1):t._e()],1)})),t.canEdit&&t.imgList.length<t.maxPhotoNum?i("v-uni-view",{staticClass:"solids",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.ChooseImage.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"cuIcon-cameraadd"})],1):t._e()],2)],1)],1)},a=[]},a4e1:function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.queryOrgInfo=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.queryOrgInfo,data:e,success:function(t){i(t)},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.queryStaffListInfo=function(t,e){return new Promise((function(i,n){t.context.get({url:a.default.queryStaffListInfo,data:e,success:function(t){i(t)},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.uploadImageAsync=function(t,e){return new Promise((function(i,n){e.context.post({url:a.default.uploadImage,data:t,success:function(t){if(200==t.statusCode){var e=t.data;i(e)}},fail:function(t){uni.hideLoading(),uni.showToast({title:i18n.t("server_error"),icon:"none"})}})}))},i("bf0f");var a=n(i("f3d1"))},cc44:function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.getFileType=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t.split("."),i=e[e.length-1];if(!i)return"";i=i.toLocaleLowerCase();var n=["png","jpg","jpeg","bmp","gif","webp"];if(n.includes(i))return"image";var a=["mp4","m4v"];if(a.includes(i))return"video";var o=["mp3","m4a","wav","aac"];if(o.includes(i))return"audio";var c=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","plain"];return c.includes(i)?"office":"unknown"},e.preventClick=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this;i.onoff?(i.onoff=!1,t(e)):uni.showToast({title:"操作过于频繁",icon:"none"})},i("4626")},d849:function(t,e,i){"use strict";i.r(e);var n=i("37c9"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},e63e:function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("bf0f"),i("2797"),i("aa9c"),i("01a2"),i("e39c");n(i("91c2"));var a=i("cc44"),o=i("7ecf"),c=i("dae2"),s=(n(i("f3d1")),n(i("3d9b"))),u=n(i("9b8e"));u.default.prototype.$preventClick=a.preventClick;var r={data:function(){return{onoff:!0,taskId:"",taskDetailId:"",machineId:"",machineName:"",pointStartTime:"",pointEndTime:"",patrolIndex:0,patrolType:"10001",patrolTypeName:"请选择",description:"",photos:[],imgList:[],communityId:"",userId:"",userName:"",titles:[],standardId:"",mapKey:"",uploadImage:{maxPhotoNum:4,imgTitle:"保养图片",canEdit:!0}}},components:{uploadImageAsync:s.default},onLoad:function(t){this.java110Context.onLoad();this.taskDetailId=t.taskDetailId,this.taskId=t.taskId,this.machineId=t.machineId,this.machineName=t.machineName,this.standardId=t.standardId,this.communityId=(0,c.getCurrentCommunity)().communityId;var e=this.java110Context.getUserInfo();this.userName=e.userName,this.userId=e.userId,this._loadMaintainanceItem()},methods:{sendImagesData:function(t){var e=this;this.photos=[],t.length>0&&t.forEach((function(t){e.photos.push(t.fileId)}))},_loadMaintainanceItem:function(){var t=this;(0,o.queryMaintainanceItemTitle)(this,{communityId:t.communityId,standardId:t.standardId,page:1,row:100}).then((function(e){e.forEach((function(t){"1001"==t.titleType?t.radio="":"2002"==t.titleType?(t.radio=[],t.titleValues.forEach((function(e){t.radio.push({checked:!1,itemValue:e.itemValue,selected:"0"})}))):t.radio=""})),t.titles=e}))},_submitExcuteMaintainance:function(){var t=this;this.description="",this.titles.forEach((function(e){var i="";"2002"==e.titleType?(e.radio.forEach((function(t){"1"==t.selected&&(i+=t.itemValue+",")})),t.description+=e.itemTitle+":"+i+";"):t.description+=e.itemTitle+":"+e.radio+";"})),(0,o.updateMaintainanceTaskDetail)(this,{taskId:this.taskId,taskDetailId:this.taskDetailId,machineId:this.machineId,machineName:this.machineName,communityId:this.communityId,description:this.description,photos:this.photos,userId:this.userId,userName:this.userName,latitude:this.latitude,longitude:this.longitude}).then((function(t){wx.showToast({title:t.msg,icon:"none",duration:2e3}),0!=t.code||uni.navigateBack({delta:1})}))},radioChange:function(t,e){console.log(t,e),e.radio=t.detail.value,console.log("item.radio",e.radio,t)},checkboxChange:function(t,e){e.radio.forEach((function(t){t.selected="0",t.checked=!1})),e.radio.forEach((function(e){t.detail.value.forEach((function(t){e.itemValue==t&&"0"==e.selected&&(e.selected="1",e.checked=!0)}))})),console.log("item.radio",e.radio,t)}}};e.default=r},f2de:function(t,e,i){"use strict";i.r(e);var n=i("94f1"),a=i("9521");for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("8288");var c=i("828b"),s=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"012e15e1",null,!1,n["a"],void 0);e["default"]=s.exports}}]);