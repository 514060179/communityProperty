(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-work-workDetail"],{"098c":function(t,e,n){var i=n("132f5");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("967d").default;o("3f327c03",i,!0,{sourceMap:!1,shadowMode:!1})},"132f5":function(t,e,n){var i=n("c86c");e=i(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.block__title[data-v-61f1f1b5]{margin:0;font-weight:400;font-size:14px;color:rgba(69,90,100,.6);padding:%?40?% %?30?% %?20?%}',""]),t.exports=e},"20f3":function(t,e,n){"use strict";var i=n("8bdb"),o=n("5145");i({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},"36c8":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var i={lFile:n("fbe4").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("l-file",{ref:"lFile",on:{"up-success":function(e){arguments[0]=e=t.$handleEvent(e),t.onSuccess.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"flex justify-between"},[n("v-uni-view",{staticClass:"block__title"},[t._v(t._s(t.$t("work_order_details")))]),t.staffId==t.workTaskDetailInfo.createUserId?n("v-uni-view",{staticStyle:{padding:"32rpx 30rpx 20rpx"}},[n("v-uni-button",{staticClass:"cu-btn round sm line-blue margin-left-sm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._toEditWork()}}},[t._v(t._s(t.$t("edit")))]),n("v-uni-button",{staticClass:"cu-btn round sm line-red margin-left-sm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._openDeleteWork()}}},[t._v(t._s(t.$t("delete")))])],1):t._e()],1),n("v-uni-view",{staticClass:"cu-list menu "},[n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("work_order_number")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.workId))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("work_order_name")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.workName))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("type_name")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.typeName))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("identifier")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s("1001"==t.workTaskDetailInfo.workCycle?t.$t("one_time_work_order"):t.$t("periodic_work_order")))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("time_period")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.startTime)+"~"+t._s(t.workTaskDetailInfo.endTime))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("initiator")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.createUserName))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("processor")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.curStaffName||"-"))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("cc_person")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.curCopyName||"-"))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("status")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.stateName))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("creation_time")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.createTime))])],1)],1),n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(t.$t("content")))])],1),n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm"},[t._v(t._s(t.workTaskDetailInfo.content))])],1)],1)],1),t.events&&t.events.length>0?n("v-uni-view",{staticClass:"cu-timeline margin-top"},[n("v-uni-view",{staticClass:"cu-time"},[t._v(t._s(t.$t("circulation")))]),t._l(t.events,(function(e,i){return n("v-uni-view",{key:i,staticClass:"cu-item "},[n("v-uni-view",{staticClass:"bg-cyan content"},[n("v-uni-text",[t._v(t._s(e.staffName))]),t._v("在 "+t._s(e.createTime)+" "+t._s(t.$t("task_processing")))],1),n("v-uni-view",{staticClass:"bg-cyan content"},[n("v-uni-text",[t._v(t._s(t.$t("processing_opinion"))+"：")]),t._v(t._s(e.remark))],1)],1)}))],2):t._e(),t.files&&t.files.length>0?n("v-uni-view",[n("v-uni-view",{staticClass:"block__title"},[t._v(t._s(t.$t("attachments")))]),n("v-uni-view",{staticClass:"cu-list menu "},t._l(t.files,(function(e,i){return n("v-uni-view",{key:i,staticClass:"cu-item"},[n("v-uni-view",{staticClass:"content"},[n("v-uni-text",{staticClass:"text-grey"},[t._v(t._s(e.staffName))])],1),e.pathUrl?n("v-uni-view",{staticClass:"action"},[n("v-uni-text",{staticClass:"text-grey text-sm",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.downloadImg(e.pathUrl)}}},[t._v(t._s(t.$t("download")))])],1):t._e()],1)})),1)],1):t._e(),n("v-uni-view",{staticClass:"cu-modal",class:1==t.delWorkDetailFlag?"show":""},[n("v-uni-view",{staticClass:"cu-dialog"},[n("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[n("v-uni-view",{staticClass:"content"},[t._v(t._s(t.$t("warm_prompt")))]),n("v-uni-view",{staticClass:"action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._cancleCall()}}},[n("v-uni-text",{staticClass:"cuIcon-close text-red"})],1)],1),n("v-uni-view",{staticClass:"padding-xl"},[t._v(t._s(t.$t("confirm_delete_work_order"))+"？")]),n("v-uni-view",{staticClass:"cu-bar bg-white justify-end"},[n("v-uni-view",{staticClass:"action margin-0 flex-sub  solid-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._cancleDelete()}}},[t._v(t._s(t.$t("dialog_cancel")))]),n("v-uni-view",{staticClass:"action margin-0 flex-sub text-green solid-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._doDeleteWork()}}},[t._v(t._s(t.$t("dialog_ok")))])],1)],1)],1)],1)},s=[]},"3e42":function(t,e,n){"use strict";n("6a54");var i=n("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.deleteWorkPool=function(t,e){return new Promise((function(n,i){uni.showLoading({title:"提交中..."}),t.context.post({url:o.default.deleteWorkPool,data:e,success:function(t){uni.hideLoading(),uni.showToast({icon:"none",title:t.data.msg}),0!=t.data.code||n(t.data)},fail:function(t){uni.hideLoading(),wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.finishWorkCopy=function(t,e){return new Promise((function(n,i){uni.showLoading({title:"提交中..."}),t.context.post({url:o.default.finishWorkCopy,data:e,success:function(t){uni.hideLoading(),uni.showToast({icon:"none",title:t.data.msg}),0!=t.data.code||n(t.data)},fail:function(t){uni.hideLoading(),wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.finishWorkTask=function(t,e){return new Promise((function(n,i){uni.showLoading({title:"提交中..."}),t.context.post({url:o.default.finishWorkTask,data:e,success:function(t){uni.hideLoading(),uni.showToast({icon:"none",title:t.data.msg}),0!=t.data.code||n(t.data)},fail:function(t){uni.hideLoading(),wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getCopyWork=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.queryCopyWork,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getTaskWork=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.queryTaskWork,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkCopy=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkCopy,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkCycle=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkCycle,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkEvent=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkEvent,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkPool=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkPool,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkPoolFile=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkPoolFile,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.getWorkTask=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkTask,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.queryStartWork=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.queryStartWork,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.queryWorkType=function(t,e){return new Promise((function(n,i){t.context.get({url:o.default.listWorkType,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.saveWorkPool=function(t,e){return new Promise((function(n,i){uni.showLoading({title:"提交中..."}),t.context.post({url:o.default.saveWorkPool,data:e,success:function(t){uni.hideLoading(),uni.showToast({icon:"none",title:t.data.msg}),0!=t.data.code||n(t.data)},fail:function(t){uni.hideLoading(),wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},e.updateWorkPool=function(t,e){return new Promise((function(n,i){uni.showLoading({title:"提交中..."}),t.context.post({url:o.default.updateWorkPool,data:e,success:function(t){uni.hideLoading(),uni.showToast({icon:"none",title:t.data.msg}),0!=t.data.code||n(t.data)},fail:function(t){uni.hideLoading(),wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},n("bf0f");var o=i(n("f3d1"))},"53ea":function(t,e,n){"use strict";var i=n("098c"),o=n.n(i);o.a},"7b53":function(t,e,n){"use strict";n.r(e);var i=n("ff32"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a},f32b:function(t,e,n){"use strict";n.r(e);var i=n("36c8"),o=n("7b53");for(var s in o)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("53ea");var a=n("828b"),r=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,"61f1f1b5",null,!1,i["a"],void 0);e["default"]=r.exports},ff32:function(t,e,n){"use strict";n("6a54");var i=n("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("d4b5"),n("20f3"),n("c223"),n("4626");var o=i(n("f3d1")),s=(n("dae2"),n("b182")),a=n("3e42"),r={data:function(){return{viewImage:!1,viewImageSrc:"",workTaskDetailInfo:{},workId:"",taskId:"",events:[],files:[],delWorkDetailFlag:!1,staffId:""}},onLoad:function(t){this.java110Context.onLoad(),this.workId=t.workId,this.taskId=t.taskId,this.srcPath=o.default.hcBaseUrl,this.staffId=(0,s.getStaffId)(),this._queryWorkDetail(),this._queryWorkEvent(),this._queryWorkFiles()},methods:{_queryWorkDetail:function(){var t=this;(0,a.getWorkPool)(this,{page:1,row:1,workId:this.workId,taskId:this.taskId}).then((function(e){t.workTaskDetailInfo=e.data[0]}))},_queryWorkEvent:function(){var t=this;(0,a.getWorkEvent)(this,{page:1,row:100,workId:this.workId,taskId:this.taskId}).then((function(e){t.events=e.data}))},_queryWorkFiles:function(){var t=this;(0,a.getWorkPoolFile)(this,{page:1,row:100,workId:this.workId,taskId:this.taskId}).then((function(e){t.files=e.data}))},_toEditWork:function(){uni.navigateTo({url:"/pages/work/editWrok?workId="+this.workId})},_openDeleteWork:function(){this.delWorkDetailFlag=!0},_doDeleteWork:function(){(0,a.deleteWorkPool)(this,{workId:this.workId}).then((function(t){uni.navigateBack({delta:2})}))},_cancleDelete:function(){this.delWorkDetailFlag=!1},_downloadFile:function(t){var e=this;uni.downloadFile({url:t,success:function(t){if(200===t.statusCode){var n=t.tempFilePath;uni.saveFile({tempFilePath:n,success:function(t){uni.showToast({icon:"none",title:e.$t("save_successful")})}}),uni.openDocument({filePath:n,showMenu:!0,success:function(t){console.log("打开文档成功")}})}}})},onSuccess:function(t){console.log("上传成功回调",JSON.stringify(t)),uni.showToast({title:JSON.stringify(t),icon:"none"})},downloadFileAndo:function(t){console.log("開始下載",t);var e=t.substring(t.lastIndexOf(".")+1),n="".concat((new Date).getTime(),".").concat(e),i="_downloads/".concat(n);console.log("下載",i);var o=plus.downloader.createDownload(t,{filename:i},(function(t,e){200===e?(plus.nativeUI.toast("下载成功: "+t.filename),plus.io.resolveLocalFileSystemURL(t.filename,(function(t){plus.runtime.openFile(t.fullPath,{},(function(t){plus.nativeUI.toast("打开失败: "+t.message)}))}),(function(t){plus.nativeUI.toast("文件路径解析失败: "+t.message)}))):plus.nativeUI.toast("下载失败")}));o.start()},downloadFileIos:function(t){var e=t.substring(t.lastIndexOf(".")+1),n="".concat((new Date).getTime(),".").concat(e);plus.io.resolveLocalFileSystemURL("_downloads/",(function(e){var i=e.fullPath+n,o=plus.downloader.createDownload(t,{filename:i},(function(t,e){200===e?(plus.nativeUI.toast("下载成功: "+t.filename),plus.io.resolveLocalFileSystemURL(t.filename,(function(t){plus.runtime.openFile(t.toLocalURL(),{},(function(t){plus.nativeUI.toast("打开失败ios: "+t.message)}))}),(function(t){plus.nativeUI.toast("文件路径解析失败: "+t.message)}))):plus.nativeUI.toast("下载失败")}));o.start()}),(function(t){plus.nativeUI.toast("获取下载目录失败: "+t.message)}))},getFileType:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t.split("."),n=e[e.length-1];if(!n)return"";n=n.toLocaleLowerCase();var i=["png","jpg","jpeg","bmp","gif","webp"];if(i.includes(n))return"image";var o=["mp4","m4v"];if(o.includes(n))return"video";var s=["mp3","m4a","wav","aac"];if(s.includes(n))return"audio";var a=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","plain"];return a.includes(n)?"office":"unknown"},getExtension:function(t){var e=t.split("."),n=e[e.length-1];return n},downloadImg:function(t){var e=this;uni.showLoading({title:"加载中..."});var n=e.getFileType(t);"office"===n&&(console.log(t),uni.getSystemInfo({success:function(n){console.log(n.platform),"ios"===n.platform?(console.log("当前设备是 iOS"),e.downloadFileIos(t)):"android"===n.platform?(console.log("当前设备是 Android"),e.downloadFileAndo(t)):(console.log("当前设备不是 iOS 或 Android"),e._downloadFile(t))}}),uni.hideLoading()),"image"===n&&uni.downloadFile({url:t,success:function(t){var n=t.tempFilePath;uni.saveImageToPhotosAlbum({filePath:n,success:function(t){uni.hideLoading(),uni.showModal({title:"提示",content:e.$t("save_successful"),modalType:!1})},fail:function(t){"saveImageToPhotosAlbum:fail:auth denied"!==t.errMsg&&"saveImageToPhotosAlbum:fail auth deny"!==t.errMsg&&"saveImageToPhotosAlbum:fail authorize no response"!==t.errMsg||uni.showModal({title:"提示",content:"需要您授权保存相册",modalType:!1,success:function(t){uni.openSetting({success:function(t){console.log("settingdata",t),t.authSetting["scope.writePhotosAlbum"]?uni.showModal({title:"提示",content:"获取权限成功,再次点击图片即可保存",modalType:!1}):uni.showModal({title:"提示",content:"获取权限失败，将无法保存到相册哦~",modalType:!1})},fail:function(t){console.log("failData",t)},complete:function(t){console.log("finishData",t)}})}})},complete:function(t){uni.hideLoading()}})}})},saveEwm:function(){var t=this;uni.getSetting({success:function(e){e.authSetting["scope.writePhotosAlbum"]?t.save():uni.authorize({scope:"scope.writePhotosAlbum",success:function(){t.save()},fail:function(){}})}})}}};e.default=r}}]);