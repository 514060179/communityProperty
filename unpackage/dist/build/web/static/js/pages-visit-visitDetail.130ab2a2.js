(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-visit-visitDetail"],{1033:function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.auditUndoVisit=function(t,e,i){return new Promise((function(n,s){t.context.post({url:a.default.auditUndoVisit,data:e,success:function(t){n(t)},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}},i)}))},e.getVisit=function(t,e,i){return new Promise((function(n,s){t.context.get({url:a.default.listVisit,data:e,success:function(t){var e=t.data.visits;n(e)},fail:function(t){s(t)}},i)}))},e.queryFinishVisit=function(t,e,i){return new Promise((function(n,s){t.context.get({url:a.default.queryFinishVisit,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}},i)}))},e.queryNextDealUser=function(t,e,i){return new Promise((function(n,s){t.context.get({url:a.default.queryNextDealUser,data:e,success:function(t){if(0!=t.data.code)s("未包含数据");else{var e=t.data.data;n(e)}},fail:function(t){s(t)}},i)}))},e.queryOaWorkflowUser=function(t,e,i){return new Promise((function(n,s){t.context.get({url:a.default.queryOaWorkflowUser,data:e,success:function(t){if(0!=t.data.code)s("未包含数据");else{var e=t.data.data;n(e)}},fail:function(t){s(t)}},i)}))},e.queryUndoVisit=function(t,e,i){return new Promise((function(n,s){t.context.get({url:a.default.queryUndoVisit,data:e,success:function(t){0==t.data.code?n(t.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(t){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}},i)}))},i("bf0f");var a=n(i("f0de"));i("9e36")},"200f5":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var n={pickerStaffs:i("9636").default},a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"cu-form-group arrow margin-top"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("action")))]),i("v-uni-picker",{attrs:{bindchange:"PickerChange",value:t.actionIndex,"range-key":"label",range:t.actions},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.selectChange(e)}}},[i("v-uni-view",{staticClass:"picker"},[t._v(t._s(0==t.actions.length?t.$t("please_select"):t.actions[t.actionIndex].label))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group margin-top-xs"},[i("v-uni-textarea",{attrs:{placeholder:t.placeHolder},model:{value:t.audit.auditMessage,callback:function(e){t.$set(t.audit,"auditMessage",e)},expression:"audit.auditMessage"}})],1),"1100"==t.audit.auditCode&&"-2"==t.nextAudit.assignee?i("v-uni-view",{staticClass:"cu-form-group arrow margin-top-xs"},[i("v-uni-view",{staticClass:"title",staticStyle:{"white-space":"nowrap"}},[t._v(t._s(t.$t("next_processor")))]),i("pickerStaffs",{staticClass:"text-right",staticStyle:{width:"80%"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeStaff.apply(void 0,arguments)}}},[t._v(t._s(t.audit.staffName))]),i("v-uni-text",{staticClass:"cuIcon-right"})],1):t._e(),"1300"==t.audit.auditCode?i("v-uni-view",{staticClass:"cu-form-group arrow margin-top-xs"},[i("v-uni-view",{staticClass:"title",staticStyle:{"white-space":"nowrap"}},[t._v(t._s(t.$t("next_processor")))]),i("pickerStaffs",{staticClass:"text-right",staticStyle:{width:"80%"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeStaff.apply(void 0,arguments)}}},[t._v(t._s(t.audit.staffName))]),i("v-uni-text",{staticClass:"cuIcon-right"})],1):t._e(),i("v-uni-view",{staticClass:"button_up_blank"}),i("v-uni-view",{staticClass:"flex flex-direction"},[i("v-uni-button",{staticClass:"cu-btn bg-blue margin-tb-sm lg",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._doSubmit()}}},[t._v("提交")])],1)],1)},s=[]},"257d":function(t,e,i){var n=i("64a9");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("967d").default;a("4c54a014",n,!0,{sourceMap:!1,shadowMode:!1})},"426c":function(t,e,i){"use strict";i.r(e);var n=i("93607"),a=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},"64a9":function(t,e,i){var n=i("c86c");e=n(!1),e.push([t.i,".block__title[data-v-4d59dde6]{margin:0;font-weight:400;font-size:14px;color:rgba(69,90,100,.6);padding:%?40?% %?30?% %?20?%}.button_up_blank[data-v-4d59dde6]{height:%?40?%}",""]),t.exports=e},"6ed4":function(t,e,i){"use strict";i.r(e);var n=i("200f5"),a=i("8cd2");for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("7ff4");var r=i("828b"),o=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"4d59dde6",null,!1,n["a"],void 0);e["default"]=o.exports},"7ff4":function(t,e,i){"use strict";var n=i("257d"),a=i.n(n);a.a},"8cd2":function(t,e,i){"use strict";i.r(e);var n=i("e093"),a=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},93607:function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("bf0f"),i("2797"),i("aa9c"),i("fd3c"),i("d4b5");var n=i("638b"),a=[],s={data:function(){return{value:[0,0,0],array:[],index:0,companys:[]}},created:function(){var t=this,e=this,i=this.java110Context.getUserInfo(),a=i.storeId;(0,n.queryStaffInfos)(this,{page:1,row:300,storeId:a},0==this.communitys.length).then((function(t){var i=t.data.staffs;return e.communitys=e.freshStaff(i),e.communitys})).then((function(e){console.log("_communitys",e),t.initSelect()}))},methods:{initSelect:function(){this.updateSourceDate().updateAddressDate().$forceUpdate()},freshStaff:function(t){var e=this,i=[];return t.forEach((function(t){e._hasIn(i,t.parentOrgId)||i.push({id:t.parentOrgId,name:t.parentOrgName,departments:[]})})),i.forEach((function(i){t.forEach((function(t){e._hasDepartMentIn(i,i.departments,t)&&i.departments.push({id:t.orgId,name:t.orgName,users:[]})}))})),i.forEach((function(i){i.departments.forEach((function(i){t.forEach((function(t){e._hasUserIn(i,i.users,t)&&i.users.push({id:t.userId,name:t.userName})}))}))})),i},_hasIn:function(t,e){var i=!1;return t.forEach((function(t){t.id==e&&(i=!0)})),i},_hasDepartMentIn:function(t,e,i){var n=!1;return 0==e.length&&t.id==i.parentOrgId||(this._hasIn(e,i.orgId)||t.id!=i.parentOrgId||(n=!0),n)},_hasUserIn:function(t,e,i){var n=!1;return 0==e&&t.id==i.orgId||(this._hasIn(e,i.userId)||t.id!=i.orgId||(n=!0),n)},columnchange:function(t){this.updateSelectIndex(t.detail.column,t.detail.value).updateSourceDate().updateAddressDate().$forceUpdate()},updateSourceDate:function(){return this.array=[],this.array[0]=this.communitys.map((function(t){return{name:t.name,code:t.id}})),this.array[1]=this.communitys[this.value[0]].departments.map((function(t){return{name:t.name,code:t.id}})),this.array[2]=this.communitys[this.value[0]].departments[this.value[1]].users.map((function(t){return{name:t.name,code:t.id}})),this},updateSelectIndex:function(t,e){var i=JSON.parse(JSON.stringify(this.value));return i[t]=e,0===t&&(i[1]=0,i[2]=0),1===t&&(i[2]=0),this.value=i,this},updateAddressDate:function(){return a=[],a.push({name:this.array[0][this.value[0]].name,code:this.array[0][this.value[0]].code}),a.push({name:this.array[1][this.value[1]].name,code:this.array[1][this.value[1]].code}),a.push({name:this.array[2][this.value[2]].name,code:this.array[2][this.value[2]].code}),this},bindPickerChange:function(t){return this.$emit("change",{index:this.value,data:a}),this}}};e.default=s},9636:function(t,e,i){"use strict";i.r(e);var n=i("b9b0"),a=i("426c");for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);var r=i("828b"),o=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"5bae64b0",null,!1,n["a"],void 0);e["default"]=o.exports},ac80:function(t,e,i){"use strict";i.r(e);var n=i("cb06"),a=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},b9b0:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-picker",{attrs:{range:t.array,"range-key":"name",value:t.value,mode:"multiSelector"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.bindPickerChange.apply(void 0,arguments)},columnchange:function(e){arguments[0]=e=t.$handleEvent(e),t.columnchange.apply(void 0,arguments)}}},[t._t("default")],2)},a=[]},bc01:function(t,e,i){"use strict";i.r(e);var n=i("cacf"),a=i("ac80");for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("c6e5");var r=i("828b"),o=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"7a5b28de",null,!1,n["a"],void 0);e["default"]=o.exports},c6e5:function(t,e,i){"use strict";var n=i("ca27"),a=i.n(n);a.a},ca27:function(t,e,i){var n=i("d794");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("967d").default;a("78b58258",n,!0,{sourceMap:!1,shadowMode:!1})},cacf:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"block__title"},[t._v(t._s(t.$t("basic_info")))]),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("visitor")))]),i("v-uni-view",[t._v(t._s(t.order.vName)+"("+t._s(t.order.phoneNumber)+")")])],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("companions")))]),i("v-uni-view",[t._v(t._s(t.order.entourage))])],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("owner")))]),i("v-uni-view",[t._v(t._s(t.order.ownerName)+"("+t._s(t.order.ownerTel)+")")])],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("status")))]),i("v-uni-view",[t._v(t._s(t.order.stateName))])],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("license_plate")))]),i("v-uni-view",[t._v(t._s(t.order.carNum))])],1),i("v-uni-view",{staticClass:"cu-form-group arrow"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("visit_time")))]),i("v-uni-view",[t._v(t._s(t.order.visitTime))])],1),i("v-uni-view",{staticClass:"cu-form-group arrow"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("leave_time")))]),i("v-uni-view",[t._v(t._s(t.order.departureTime))])],1),i("v-uni-view",{staticClass:"cu-form-group arrow"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("visitor_description")))]),i("v-uni-view",[t._v(t._s(t.order.visitCase))])],1),i("v-uni-view",{staticClass:"cu-form-group arrow"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(t.$t("visitor_photo")))]),i("v-uni-view",{staticClass:"padding-sm"},[i("v-uni-image",{staticStyle:{height:"200upx",width:"200upx"},attrs:{src:t.order.url}})],1)],1),i("v-uni-view",{staticClass:"block__title"},[t._v(t._s(t.$t("approval_process")))]),t._l(t.comments,(function(e,n){return i("v-uni-view",{staticClass:"cu-form-group arrow"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(e.staffName))]),i("v-uni-view",{},[e.endTime?i("v-uni-text",[t._v(t._s(t.$t("processing_completed")))]):i("v-uni-text",[t._v(t._s(t.$t("processing")))]),e.context?i("v-uni-text",[t._v("("+t._s(e.context)+")")]):t._e()],1)],1)})),i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.action&&"Audit"==t.action,expression:"action && action == 'Audit'"}]},[i("audit-visit",{ref:"auditVisitRef"})],1)],2)},a=[]},cb06:function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("d4b5");var a=i("1033"),s=i("2d9e"),r=n(i("6ed4")),o={data:function(){return{order:{},resNames:[],vId:"",comments:[],flowId:"",action:"",taskId:"",audit:{auditCode:"1100",auditMessage:"",staffId:"",staffName:"",taskId:""},nextAudit:{}}},onLoad:function(t){this.vId=t.vId,this.flowId=t.flowId,this.action=t.action,this.taskId=t.taskId,this._loadDetail()},components:{auditVisit:r.default},methods:{_loadDetail:function(){var t=this;(0,a.getVisit)(this,{page:1,row:1,vId:this.vId,communityId:(0,s.getCurrentCommunity)().communityId},""==JSON.stringify(this.order)).then((function(e){t.order=e[0],t._loadComment()})).then((function(){t.action&&"Audit"==t.action&&t.$refs.auditVisitRef.initAuditVisit({taskId:t.taskId,flowId:t.flowId,vId:t.vId,startUserId:t.order.createUserId})}))},_loadComment:function(){var t=this;(0,a.queryOaWorkflowUser)(this,{page:1,row:100,id:this.vId,communityId:(0,s.getCurrentCommunity)().communityId,flowId:this.order.flowId},0==this.comments.length).then((function(e){t.comments=e}))}}};e.default=o},d794:function(t,e,i){var n=i("c86c");e=n(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.block__title[data-v-7a5b28de]{margin:0;font-weight:400;font-size:14px;color:rgba(69,90,100,.6);padding:%?40?% %?30?% %?20?%}.button_up_blank[data-v-7a5b28de]{height:%?40?%}',""]),t.exports=e},e093:function(t,e,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("d4b5"),i("aa9c");var a=n(i("9636")),s=i("1033"),r=i("2d9e"),o={name:"auditVisit",data:function(){return{taskId:"",flowId:"",id:"",actionIndex:0,actions:[],audit:{auditCode:"1100",auditMessage:"",staffId:"",staffName:"请选择",taskId:""},startUserId:"",nextAudit:{}}},computed:{placeHolder:function(){return this.$t("please_enter_opinion")}},components:{pickerStaffs:a.default},methods:{initAuditVisit:function(t){this.taskId=t.taskId,this.flowId=t.flowId,this.vId=t.vId,this.startUserId=t.startUserId,this._getNextTask()},selectChange:function(t){this.actionIndex=t.target.value;var e=this.actions[this.actionIndex];void 0!=e&&(this.audit.auditCode=e.value)},changeStaff:function(t){console.log(t),t.data.length<3||(this.audit.staffId=t.data[2].code,this.audit.staffName=t.data[2].name)},_doSubmit:function(){var t=this.audit;t.flowId=this.flowId,t.vId=this.vId,t.taskId=this.taskId,"-2"!=this.nextAudit.assignee&&(t.staffId=this.nextAudit.assignee),t.auditCode?t.auditMessage?"1200"==t.auditCode||"1400"==t.auditCode||t.staffId?(0,s.auditUndoVisit)(this,t,!0).then((function(t){if(0==t.data.code)return uni.showToast({title:"提交成功",icon:"none",duration:2e3}),void uni.navigateBack({delta:1});uni.showToast({title:t.data.msg,icon:"none",duration:2e3})})):vc.toast("请选择下一节点处理人"):vc.toast("请填写说明"):vc.toast("请选择状态")},_getNextTask:function(){var t=this;(0,s.queryNextDealUser)(this,{taskId:this.taskId,flowId:this.flowId,startUserId:this.startUserId,communityId:(0,r.getCurrentCommunity)().communityId},"{}"===JSON.stringify(this.nextAudit)).then((function(e){var i=e[0];t.nextAudit=i,(i.hasOwnProperty("next")||i.hasOwnProperty("exit"))&&t.actions.push({label:"同意",value:"1100"}),i.hasOwnProperty("back")&&t.actions.push({label:"退回",value:"1200"}),i.hasOwnProperty("backIndex")&&t.actions.push({label:"退回至提交者",value:"1400"}),t.actions.push({label:"转单",value:"1300"})}))}}};e.default=o}}]);