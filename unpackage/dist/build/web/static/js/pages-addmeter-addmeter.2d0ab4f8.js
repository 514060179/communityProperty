(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-addmeter-addmeter"],{"1f66":function(e,t,i){"use strict";i.r(t);var n=i("a28d"),r=i("57d8");for(var o in r)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(o);i("7c8c");var s=i("828b"),a=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"1c5a88a1",null,!1,n["a"],void 0);t["default"]=a.exports},"29c2":function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("e838"),i("5c47"),i("a1c1");var r=i("7b58"),o=n(i("ecef")),s=n(i("0a07")),a=i("dae2"),u=i("cc44"),c=n(i("9b8e"));c.default.prototype.$preventClick=u.preventClick;var l={data:function(){return{onoff:!0,floorNum:"",floorId:"",unitNum:"",unitId:"",roomNum:"",roomId:"",communityId:"",feeType_index:-1,feeTypes:[{id:"888800010009",name:"燃气费"}],feeConfig_index:-1,feeConfigs:[],objType:"3333",preDegrees:0,preReadingTime:null,curDegrees:"",curReadingTime:null,remark:"",meterTypes:[],meterType:"",meterTypeIndex:-1}},components:{uniDatetimePicker:s.default},onLoad:function(){this.java110Context.onLoad(),this.preReadingTime=o.default.getCurrentDateTime(),this.communityId=(0,a.getCurrentCommunity)().communityId,this._listMeterTypes()},onShow:function(){var e=uni.getStorageSync("_selectFloor");console.log(e),this.util.isNotNull(e)&&(this.floorNum=e.floorNum+this.$t("building_block"),this.floorId=e.floorId);var t=uni.getStorageSync("_selectUnit");this.util.isNotNull(t)&&(this.unitNum=t.unitNum+this.$t("unit"),this.unitId=t.unitId);var i=uni.getStorageSync("_selectRoom");this.util.isNotNull(i)&&(this.roomNum=i.roomNum+this.$t("room"),this.roomId=i.roomId,this._queryPreMeterWater())},onUnload:function(){uni.removeStorageSync("_selectFloor"),uni.removeStorageSync("_selectUnit"),uni.removeStorageSync("_selectRoom")},methods:{feeTypesChange:function(e){var t=this,i=e.detail.value;this.feeType_index=i;var n=this.feeTypes[i],o={page:1,row:20,communityId:this.communityId,feeTypeCd:n.id,isDefault:"F",valid:1};(0,r.queryFeeTypesItems)(this,o).then((function(e){t.feeConfig_index=-1,t.feeConfigs=e})),this._queryPreMeterWater()},meterTypeChange:function(e){var t=e.detail.value;this.meterTypeIndex=t;var i=this.meterTypes[t];this.meterType=i.typeId},feeConfigsChange:function(e){var t=e.detail.value;this.feeConfig_index=t},_listMeterTypes:function(){var e=this;(0,r.listMeterType)(this,{page:1,row:50,communityId:this.communityId}).then((function(t){e.meterTypes=t.data}))},_queryPreMeterWater:function(){var e=this;if(!(this.feeType_index<0||""==this.roomId)){var t=this.meterType,i={communityId:this.communityId,objId:this.roomId,objType:this.objType,meterType:t};(0,r.queryPreMeterWater)(this,i).then((function(t){console.log(t),t.total<1?e.preDegrees=0:(e.preDegrees=t.data[0].curDegrees,e.preReadingTime=t.data[0].curReadingTime)}))}},submitMeter:function(){var e=this,t="";if(this.feeConfig_index<0)t=this.$t("cost_mandatory");else if(""==this.roomId)t=this.$t("please_select_house");else if(""===this.preDegrees||this.preDegrees<0)t=this.$t("previous_degree_mandatory");else if(""==this.preReadingTime||null==this.preReadingTime)t=this.$t("previous_reading_time_mandatory");else if(""===this.curDegrees||this.curDegrees<0)t=this.$t("current_degree_mandatory");else if(""==this.curReadingTime||null==this.curReadingTime)t=this.$t("current_reading_time_mandatory");else if(parseFloat(this.curDegrees)<parseFloat(this.preDegrees))t=this.$t("current_degree_cannot_be_less_than_previous");else{var i=Date.parse(new Date(this.preReadingTime.replace(/-/g,"/"))),n=Date.parse(new Date(this.curReadingTime.replace(/-/g,"/")));(0==n||i-n>=0)&&(t=this.$t("current_reading_time_error"))}if(""!=t)return uni.showToast({title:t,icon:"none"}),void(this.onoff=!0);var o={communityId:this.communityId,configId:this.feeConfigs[this.feeConfig_index].configId,curDegrees:this.curDegrees,curReadingTime:this.curReadingTime,preDegrees:this.preDegrees,preReadingTime:this.preReadingTime,feeTypeCd:this.feeTypes[this.feeType_index].id,objId:this.roomId,roomId:this.roomId,objName:this.floorNum+this.unitNum+this.roomNum,objType:this.objType,remark:this.remark,meterType:this.meterType};(0,r.saveMeterWater)(this,o).then((function(t){uni.showToast({title:t.msg,duration:1500}),0==t.code?setTimeout((function(){e.onoff=!0,e.clearAddMeterWaterInfo()}),1500):e.onoff=!0}))},clearAddMeterWaterInfo:function(){uni.removeStorageSync("_selectFloor"),uni.removeStorageSync("_selectUnit"),uni.removeStorageSync("_selectRoom"),uni.redirectTo({url:"/pages/addmeter/addmeter"})},chooseFloor:function(e){uni.removeStorageSync("_selectFloor"),this.floorNum="",this.floorId="",uni.removeStorageSync("_selectUnit"),this.unitNum="",this.unitId="",uni.removeStorageSync("_selectRoom"),this.roomNum="",this.roomId="",this.context.navigateTo({url:"/pages/selectFloor/selectFloor"})},chooseUnit:function(e){null!=this.floorId&&""!=this.floorId?(uni.removeStorageSync("_selectUnit"),this.unitNum="",this.unitId="",uni.removeStorageSync("_selectRoom"),this.roomNum="",this.roomId="",this.context.navigateTo({url:"/pages/selectUnit/selectUnit?floorId="+this.floorId})):uni.showToast({title:this.$t("please_select_building_first")})},chooseRoom:function(e){null!=this.unitId&&""!=this.unitId?(uni.removeStorageSync("_selectRoom"),this.roomNum="",this.roomId="",this.context.navigateTo({url:"/pages/selectRoom/selectRoom?floorId="+this.floorId+"&unitId="+this.unitId})):uni.showToast({title:this.$t("please_select_unit_first")})}}};t.default=l},"310e":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,".cu-form-group .title[data-v-1c5a88a1]{min-width:calc(6em + 15px);white-space:nowrap}",""]),e.exports=t},"57d8":function(e,t,i){"use strict";i.r(t);var n=i("29c2"),r=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"7b58":function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.listMeterType=function(e,t){return new Promise((function(i,n){e.context.get({url:r.default.listMeterType,data:t,success:function(e){200==e.statusCode?i(e.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(e){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},t.queryFeeTypesItems=function(e,t){return new Promise((function(i,n){e.context.get({url:r.default.queryFeeTypesItems,data:t,success:function(e){200==e.statusCode?i(e.data.feeConfigs):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(e){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},t.queryPreMeterWater=function(e,t){return new Promise((function(i,n){e.context.get({url:r.default.queryPreMeterWater,data:t,success:function(e){200==e.statusCode?i(e.data):wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})},fail:function(e){wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},t.saveMeterWater=function(e,t){return new Promise((function(i,n){e.context.post({url:r.default.saveMeterWater,data:t,success:function(t){200==t.statusCode?i(t.data):(e.onoff=!0,wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3}))},fail:function(t){e.onoff=!0,wx.showToast({title:i18n.t("server_error"),icon:"none",duration:2e3})}})}))},i("bf0f");var r=n(i("f3d1"))},"7c8c":function(e,t,i){"use strict";var n=i("e0da"),r=i.n(n);r.a},a28d:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uniDatetimePicker:i("0a07").default},r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[i("v-uni-form",[i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("cost_type")))]),i("v-uni-picker",{attrs:{value:e.feeType_index,"range-key":"name",range:e.feeTypes},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.feeTypesChange.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.feeType_index>-1?e.feeTypes[e.feeType_index].name:e.$t("please_select")))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("charge_item")))]),i("v-uni-picker",{attrs:{value:e.feeConfig_index,"range-key":"feeName",range:e.feeConfigs},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.feeConfigsChange.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.feeConfig_index>-1?e.feeConfigs[e.feeConfig_index].feeName:e.$t("please_select")))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("meter_reading_type")))]),i("v-uni-picker",{attrs:{value:e.meterTypeIndex,"range-key":"typeName",range:e.meterTypes},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.meterTypeChange.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.meterTypeIndex>-1?e.meterTypes[e.meterTypeIndex].typeName:e.$t("please_select")))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group arrow",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseFloor.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("building")))]),i("v-uni-input",{attrs:{required:!0,readonly:!0,placeholder:e.$t("please_select_building"),name:"floorNum",icon:"arrow"},model:{value:e.floorNum,callback:function(t){e.floorNum=t},expression:"floorNum"}}),i("v-uni-text",{staticClass:"cuIcon-right"})],1),i("v-uni-view",{staticClass:"cu-form-group arrow",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseUnit.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("unit")))]),i("v-uni-input",{attrs:{placeholder:e.$t("please_select_unit")},model:{value:e.unitNum,callback:function(t){e.unitNum=t},expression:"unitNum"}}),i("v-uni-text",{staticClass:"cuIcon-right"})],1),i("v-uni-view",{staticClass:"cu-form-group arrow",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseRoom.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("house")))]),i("v-uni-input",{attrs:{placeholder:e.$t("please_select_house")},model:{value:e.roomNum,callback:function(t){e.roomNum=t},expression:"roomNum"}}),i("v-uni-text",{staticClass:"cuIcon-right"})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("previous_degree")))]),i("v-uni-input",{attrs:{placeholder:e.$t("previous_degree"),disabled:"disabled"},model:{value:e.preDegrees,callback:function(t){e.preDegrees=t},expression:"preDegrees"}})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("current_degree")))]),i("v-uni-input",{attrs:{placeholder:e.$t("current_degree")},model:{value:e.curDegrees,callback:function(t){e.curDegrees=t},expression:"curDegrees"}})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("previous_reading_time")))]),i("uni-datetime-picker",{attrs:{disabled:!0},model:{value:e.preReadingTime,callback:function(t){e.preReadingTime=t},expression:"preReadingTime"}})],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("current_reading_time")))]),i("uni-datetime-picker",{model:{value:e.curReadingTime,callback:function(t){e.curReadingTime=t},expression:"curReadingTime"}})],1),i("v-uni-view",{staticClass:"cu-form-group align-start"},[i("v-uni-view",{staticClass:"title"},[e._v(e._s(e.$t("remark")))]),i("v-uni-textarea",{attrs:{maxlength:"-1",placeholder:e.$t("remark_information")},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1),i("v-uni-view",{staticClass:" flex flex-direction"},[i("v-uni-button",{staticClass:"cu-btn bg-red margin-tb-sm lg",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$preventClick(e.submitMeter)}}},[e._v("提交")])],1)],1)],1)},o=[]},cc44:function(e,t,i){"use strict";i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.getFileType=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split("."),i=t[t.length-1];if(!i)return"";i=i.toLocaleLowerCase();var n=["png","jpg","jpeg","bmp","gif","webp"];if(n.includes(i))return"image";var r=["mp4","m4v"];if(r.includes(i))return"video";var o=["mp3","m4a","wav","aac"];if(o.includes(i))return"audio";var s=["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","plain"];return s.includes(i)?"office":"unknown"},t.preventClick=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this;i.onoff?(i.onoff=!1,e(t)):uni.showToast({title:"操作过于频繁",icon:"none"})},i("4626")},e0da:function(e,t,i){var n=i("310e");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("967d").default;r("269294f9",n,!0,{sourceMap:!1,shadowMode:!1})}}]);